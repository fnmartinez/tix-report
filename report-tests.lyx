#LyX 2.2 created this file. For more info see http://www.lyx.org/
\lyxformat 508
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\use_default_options true
\maintain_unincluded_children false
\language spanish
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation skip
\defskip medskip
\quotes_language french
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Section
Ensayos
\end_layout

\begin_layout Subsection
Prueba de Sistema
\end_layout

\begin_layout Subsubsection
Objetivos
\end_layout

\begin_layout Standard
La Prueba de Sistema está apuntada a corroborar el correcto funcionamiento
 del Servicio de TiX en su totalidad en condiciones normales.
 Esto significa, que se debe probar de punta a punta el Sistema, con una
 carga normal, para una persona determinada.
 La idea de esto es asegurar una calidad mínima de servicio en base a parámetros
 preestablecidos.
 
\end_layout

\begin_layout Subsubsection
Indicadores propuestos
\end_layout

\begin_layout Standard
Las métricas sobre las cuales se va a determinar que el sistema funciona
 correctamente son: 
\end_layout

\begin_layout Enumerate
Tiempo de funcionamiento, entendiéndose como la cantidad de tiempo que estuvo
 vivo el sistema durante la prueba, para lo cual pudo recibir mediciones
 del Subsistema Cliente y mostrar el progreso de la prueba a través del
 Subsistema de Presentación.
 
\end_layout

\begin_layout Enumerate
Tiempo medio de demora en obtenerse una métrica, entendiéndose como el promedio
 de los tiempos que tarda el Subsistema de Procesamiento en entregar el
 resultado de un conjunto de mediciones más el Subsistema de Presentación
 en mostrarlo.
 
\end_layout

\begin_layout Enumerate
La media del valor absoluto del error de la métrica de Uso de Ancho de Banda,
 entendiéndose como el promedio de los valores absolutos de las diferencias
 entre el valor mostrado y el valor real para cada punto de la métrica calculado
 durante la prueba.
 
\end_layout

\begin_layout Subsubsection
Consideraciones
\end_layout

\begin_layout Standard
Para esta prueba se tienen lo siguientes considerandos y supuestos:
\end_layout

\begin_layout Itemize
Se considera que el sistema es robusto y que el Tiempo de funcionamiento
 a lo largo de la prueba es una muestra lo suficientemente representativa
 del mismo en todo momento.
\end_layout

\begin_layout Itemize
Se considera que la prueba es lo suficientemente compleja para que su automatiza
ción total no sea relevante ni un punto a considerar para la presente disertació
n.
 
\end_layout

\begin_layout Itemize
Se considera una métrica aquella que puede ser visualizada a través del
 servicio tix-web del Subsistema de Presentación y Administración.
 
\end_layout

\begin_layout Itemize
Se considera negligible el efecto que tiene en el Uso de Ancho de Banda
 la carga de páginas web, la descarga esporádica de archivos con tamaño
 inferior a 1 MB y el uso en segundo plano de la conexión por parte de servicios
 como los son las redes sociales (e.g.: Facebook, Instagram, Twitter), medios
 de comunicación instantánea (e.g.: Slack, Whatsapp, Discord), portales web
 y agentes de correo electróncio (e.g.: GMail, Outlook, Outlook Express, Thunderbi
rd).
 
\end_layout

\begin_layout Itemize
No se considera negligible el efecto que tiene en el Uso de Ancho de Banda
 la descarga constante de archivos o de archivos con tamaño superior a 1
 MB, el uso de servicios o portales web de flujo de datos, sea de video
 (e.g.: YouTube, Netflix), audio (e.g.: iTunes, Spotify), u otro tipos de aplicacion
es en tiempo real (i.e.: video juegos on-line, proyectos de cómputo distribuido,
 etc).
 
\end_layout

\begin_layout Itemize
Si bien en general los Proveedores de Servicio de Internet no entregan velocidad
es simétricas, lo que podría suponer una diferencia en la calidad de las
 conexiones de subida y bajada, se considera que: 
\end_layout

\begin_deeper
\begin_layout Itemize
Como método para medir el Uso de Ancho de Banda es el mismo tanto para subida
 como para la bajada.
 
\end_layout

\begin_layout Itemize
Y que el método es robusto a esto ante la diferencia de calidad.
\end_layout

\end_deeper
\begin_layout Itemize
Por el considerando anterior, sólo se medirá el Uso de Ancho de Banda de
 bajada.
 
\end_layout

\begin_layout Itemize
No se medirá la Calidad de la conexión debido a los muchos factores externos
 que juegan con ella.
 
\end_layout

\begin_layout Itemize
Se considera que una vez insertada la métrica en la base de datos del Subsistema
 de Presentación, está lista para ser mostrada.
 Con lo que si no puede ser mostrada es que está caído el Subsistema de
 Presentación en sí.
 
\end_layout

\begin_layout Subsubsection
Metodología
\end_layout

\begin_layout Standard
Se crea un usuario en el Sistema TiX a través del Subsistema de Presentación,
 por medio de la página web.
 Luego se descarga y se instala el cliente.
 
\end_layout

\begin_layout Standard
Se instala un cliente de bittorrent en la computadora que va a realizar
 la prueba.
 La idea es saturar el enlace de forma programada para así poder tener valores
 de medición contra los cuales comparar.
 A su vez se debe asegurar que durante el periodo de la prueba ningún otro
 servicio salvo el cliente de bittorrent, el cliente de TiX y aquellos considera
dos negligibles para la saturación del ancho de banda, mantengan conexiones
 con internet.
 Durante las pruebas se utilizó el cliente Vuze 
\begin_inset CommandInset citation
LatexCommand cite
key "vuze"

\end_inset

.
 Este permite programar de forma muy granular las velocidades máximas de
 transferencia de carga y descarga.
 Para la gran mayoría de las pruebas se utilizó la configuración del programador
 de velocidades de Vuze que se muestran en el Cuadro 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:vuze-scheduler"

\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout

\family typewriter
daily pause_all from 00:00 to 01:00 # No downloads
\end_layout

\begin_layout Plain Layout

\family typewriter
daily unlimited from 01:00 to 02:00 # Download at 100%
\end_layout

\begin_layout Plain Layout

\family typewriter
daily 80_pct_speed from 02:00 to 03:00 # Download at 80%
\end_layout

\begin_layout Plain Layout

\family typewriter
daily 75_pct_speed from 03:00 to 04:00 # Download at 75%
\end_layout

\begin_layout Plain Layout

\family typewriter
daily half_speed from 04:00 to 05:00 Download at 50%
\end_layout

\begin_layout Plain Layout

\family typewriter
daily 25_pct_speed from 05:00 to 06:00 # Download at 25%
\end_layout

\begin_layout Plain Layout

\family typewriter
daily pause_all from 06:00 to 23:59 # No downloads
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Programación de las velocidades de descarga de Vuze
\begin_inset CommandInset label
LatexCommand label
name "tab:vuze-scheduler"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Para saturar la conexión se usaron los torrents de varias distribuciones
 de linux, ya que esto asegura descargas de gran tamaño por el tiempo prolongado
 que dura la prueba.
 Una vez iniciado el cliente de bittorrent, se procede a iniciar el cliente
 de TiX y se los deja corriendo durante todo el tiempo de la prueba.
 
\end_layout

\begin_layout Standard
Tras la finalización de la mismas se ejecutan las consultas que se encuentran
 en el repositorio de la prueba de sistema sobre la base de datos del Subsistema
 de Presentación.
 Estas arrojan los resultados de las métricas que nos interesan tener para
 verificar el éxito de la prueba.
 
\end_layout

\begin_layout Subsubsection
Resultados
\end_layout

\begin_layout Standard
Tras correr algunas pruebas los resultados obtenidos fueron.
 
\end_layout

\begin_layout Itemize
Tiempo de funcionamiento: 95.0% 
\end_layout

\begin_layout Itemize
Tiempo medio de demora en obtenerse una métrica: 
\begin_inset Formula $2^{\prime}\,30^{\prime\prime}$
\end_inset

 
\end_layout

\begin_layout Itemize
Media del error total de la métrica de Uso de Ancho de Banda: 0.12
\end_layout

\begin_layout Standard

\series bold
Observaciones 
\end_layout

\begin_layout Itemize
Aunque el tiempo de funcionamiento es menor al esperado, hay que tener en
 cuenta que se usa una única locación al momento de hacer las métricas,
 lo cual puede confundir el problema de un funcionamiento subpar con una
 caída del servicio desde el lado del cliente.
 Ejemplo de esto son las imágenes 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:measurement-1"

\end_inset

 y 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:measurement-2"

\end_inset

, donde para experimentos similares existen muchos menos puntos de ciertos
 periodos de la prueba.
\end_layout

\begin_layout Itemize
El error medio relativo puede dar más que el esperado debido a que el método
 utilizado, saturación mediante la descarga de torrents.
 La saturación del canal en este caso, no depende de la máquina desde donde
 se están haciendo las pruebas, sino de los pares y las semillas del torrent
 en sí.
 
\end_layout

\begin_layout Itemize
Como se puede apreciar desde las imágenes 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:measurement-1"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:measurement-2"

\end_inset

, el error no es homogéneo en todas las mediciones.
 Hay mayor error cuanto menor es el uso de la conexión.
 Esto se hace evidente también en la figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:error-1"

\end_inset

, que además muestra que los puntos de mayor error son aquellos donde existen
 saltos bruscos de uso de datos.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename img/report-tests/usage-vs-expected.png
	scale 35

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Medición contra valor esperado
\begin_inset CommandInset label
LatexCommand label
name "fig:measurement-1"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename img/report-tests/error-1.png
	scale 35

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Error de la medición de la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:measurement-1"

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:error-1"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename img/report-tests/usage-vs-expected-2.png
	scale 35

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Otra medición contra su valor esperado
\begin_inset CommandInset label
LatexCommand label
name "fig:measurement-2"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Prueba de Carga
\end_layout

\begin_layout Subsubsection
Objetivos
\end_layout

\begin_layout Standard
La Prueba de Carga está apuntada a medir la carga máxima del Sistema TiX
 y encontrar los cuellos de botella del mismo.
 Además, sirve como experimento para entender cómo es que se comporta un
 Sistema Complejo como esto y cuales son sus posibles mejoras.
 
\end_layout

\begin_layout Standard
Debido a la dinámica operativa de TiX, el servicio genera un gran nivel
 de carga, la cual, si bien es constante, es mucho más alta de lo que suele
 recibir un servidor web con la misma cantidad de usuarios.
 En un escenario ideal, el servicio tendría que ejecutarse en un espacio
 el cual permita el libre escalamiento de recursos, para cubrir eventuales
 picos de tráfico e infinitos usuarios.
 Lamentablemente esto es financieramente inviable, por lo que es necesario
 conocer con gran precisión cuál es el máximo número de usuarios que la
 plataforma puede soportar bajo la infraestructura en la cual se encuentra
 corriendo el servicio.
 
\end_layout

\begin_layout Subsubsection
Indicadores propuestos
\end_layout

\begin_layout Standard
Para esta Prueba se considera una única 
\end_layout

\begin_layout Enumerate
Cantidad máxima de usuarios con el sistema saturado.
 
\end_layout

\begin_layout Standard
Si bien existen muchas otras métricas que podrían resultar interesantes,
 como tiempo de funcionamiento para el sistema saturado, o degradación de
 la calidad del servicio con el sistema saturado, se entiende que el objetivo
 del presente Proyecto no es hacer una auditoría exhaustiva del Sistema,
 sino asegurar métricas mínimas de funcionamiento.
 
\end_layout

\begin_layout Subsubsection
Consideraciones
\end_layout

\begin_layout Standard
Para esta prueba se tienen los siguientes considerandos y supuestos:
\end_layout

\begin_layout Itemize
La infraestructura sobre la que corre el sistema está compuesta por un servidor
 con las especificaciones descritas en el Cuadro 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:server-specs"

\end_inset

.
\end_layout

\begin_layout Itemize
Dado el funcionamiento del Subsistema de Ingesta y Procesamiento, se considera
 que para probar la carga del sistema no es necesario usar múltiples usuarios,
 pero sí múltiples instalaciones.
\end_layout

\begin_layout Itemize
Se considera que para probar la carga del sistema, los resultados de las
 métricas no influyen.
 Es decir, el procesamiento de las mediciones y los resultados que estos
 arrojen no cambian el resultado de la Prueba de Carga.
 Por lo que los clientes pueden ser desplegados en cualquier infraestructura,
 desde cualquier lugar del mundo.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout

\family typewriter
System: 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Host: tix.innova-red.net 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Kernel: 4.4.0-83-generic x86_64 (64 bit gcc: 5.4.0) 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Console: tty 1 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Distro: Ubuntu 16.04 xenial
\end_layout

\begin_layout Plain Layout

\family typewriter
Machine: 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

System: Dell product: PowerEdge R210 II serial: BQK2TW1 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Mobo: Dell model: 03X6X0 v: A02 serial: ..CN708212BR2HYQ.
 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Bios: Dell v: 2.2.3 date: 10/25/2012
\end_layout

\begin_layout Plain Layout

\family typewriter
CPU: 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Quad core Intel Xeon E31220 (-HT-MCP-) cache: 8192 KB flags: (lm nx sse
 sse2 sse3 sse4_1 sse4_2 ssse3 vmx) bmips: 24744 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

clock speeds: max: 3400 MHz 1: 1652 MHz 2: 1600 MHz 3: 1686 MHz 4: 1600
 MHz
\end_layout

\begin_layout Plain Layout

\family typewriter
Graphics: 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Card: Matrox Systems MGA G200eW WPCM450 bus-ID: 03:03.0 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Display Server: N/A driver: N/A tty size: 237x56 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Advanced Data: N/A for root out of X
\end_layout

\begin_layout Plain Layout

\family typewriter
Network: 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Card-1: Broadcom NetXtreme II BCM5716 Gigabit Ethernet driver: bnx2 v: 2.2.6
 bus-ID: 02:00.0 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset


\begin_inset space \qquad{}
\end_inset

IF: eno1 state: up speed: 1000 Mbps duplex: full mac: d4:ae:52:c7:83:53
 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Card-2: Broadcom NetXtreme II BCM5716 Gigabit Ethernet driver: bnx2 v: 2.2.6
 bus-ID: 02:00.1
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset


\begin_inset space \qquad{}
\end_inset

IF: eno2 state: down mac: d4:ae:52:c7:83:54
\end_layout

\begin_layout Plain Layout

\family typewriter
Drives: 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

HDD Total Size: 499.6GB (9.8% used) ID-1: /dev/sda model: 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Virtual_Disk size: 499.6GB temp: 0C
\end_layout

\begin_layout Plain Layout

\family typewriter
Partition: 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

ID-1: / size: 19G used: 13G (75%) fs: ext4 dev: /dev/sda7
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

ID-2: swap-1 size: 4.09GB used: 0.87GB (21%) fs: swap dev: /dev/sda6
\end_layout

\begin_layout Plain Layout

\family typewriter
RAID: No RAID devices: /proc/mdstat, md_mod kernel module present
\end_layout

\begin_layout Plain Layout

\family typewriter
Sensors: 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

System Temperatures: cpu: 29.8C mobo: N/A
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Fan Speeds (in rpm): cpu: N/A
\end_layout

\begin_layout Plain Layout

\family typewriter
Info: 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Processes: 203 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Uptime: 144 days 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Memory: 1166.0/3921.2MB 
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Init: systemd runlevel: 5 Gcc sys: 5.4.0
\end_layout

\begin_layout Plain Layout

\family typewriter
\begin_inset space \qquad{}
\end_inset

Client: Shell (bash 4.3.481) inxi: 2.2.35 
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Especificaciones del Servidor de acuerdo a la salida del script inxi 
\begin_inset CommandInset citation
LatexCommand cite
key "inxidoc"

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "tab:server-specs"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Metodología
\end_layout

\begin_layout Standard
La metodología para realizar la prueba de carga consta de dos partes: por
 un lado la generación de clientes para realizar la prueba, y por el otro
 el análisis de los resultados para saber si la prueba fue exitosa.
 
\end_layout

\begin_layout Standard

\series bold
Generación de Clientes 
\end_layout

\begin_layout Standard
Para la Generación de clientes, se utiliza una versión modificada del cliente
 actual, la cual cumple el mismo rol que el cliente estándar (autenticarse
 al servicio, crear una instalación y generar reportes).
 Esto permite correr múltiples instancias del cliente en el mismo dispositivo,
 con un consumo de recursos menor.
 
\end_layout

\begin_layout Standard
Por otro lado se utiliza JMeter 
\begin_inset CommandInset citation
LatexCommand cite
key "jmeter"

\end_inset

, una herramienta especializada en generación de pruebas de carga.
 Esta permite crear múltiples instancias del cliente, las cuales son ejecutadas
 en simultáneo y genera un reporte basado en el resultado de su ejecución.
 
\end_layout

\begin_layout Standard
Finalmente, se necesita un servidor para poder correr la prueba de stress.
 Dada la carga generada y la necesidad de mantener el servicio en funcionamiento
 por al menos 24 horas, es recomendable que se realice en un servidor donde
 se pueda monitorear su funcionamiento.
 Aunque también puede ser realizado en cualquier PC.
 
\end_layout

\begin_layout Standard
Encontramos dos indicadores clave para conocer si la prueba podía ser corrida
 de manera exitosa: 
\end_layout

\begin_layout Enumerate
Cantidad de operaciones de E/S en el cliente.
 
\end_layout

\begin_layout Enumerate
Estado del consumo de CPU en el servidor de los clientes.
 
\end_layout

\begin_layout Standard
El primero es necesario para asegurarse que la prueba está efectivamente
 corriendo al ratio que le fue solicitado.
 Por ejemplo, si se encuentra corriendo aproximadamente 1000 instancias,
 entonces tendrían que haber aproximadamente 1000 escrituras en archivo
 por segundo.
 
\end_layout

\begin_layout Standard
En segundo lugar, el estado de consumo de CPU es un factor clave para conocer
 si el servidor donde están corriendo los clientes se encuentra al límite
 de procesamiento.
 Al momento en que este se quede sin recursos, los clientes se volverán
 más lentos.
 
\end_layout

\begin_layout Standard
Si alguno de estos indicadores muestra algún problema, entonces prueba no
 está corriendo correctamente y sus resultados no pueden ser fiables.
 
\end_layout

\begin_layout Standard

\series bold
Analisis de Resultados 
\end_layout

\begin_layout Standard
El análisis de resultados comprende todas aquellas herramientas que pueden
 ser utilizadas para conocer cómo está funcionando internamente el Servicio.
 Esto incluye: 
\end_layout

\begin_layout Itemize
Análisis de logs.
 
\end_layout

\begin_layout Itemize
Análisis de carga del sistema.
 
\end_layout

\begin_layout Itemize
Análisis del estado de las colas de procesamiento.
 
\end_layout

\begin_layout Standard
Siendo este último en particularmente crítico para conocer si el sistema
 está funcionando correctamente o se encuentra saturado.
 
\end_layout

\begin_layout Standard
El Análisis de logs se hace utilizando Docker Compose y su comando para
 visualizar logs.
 La principal idea de esto es detectar problemas en la y excepciones arrojadas
 por los servicios.
 También es entender el funcionamiento de cada uno de los servicios bajo
 estrés de manera más específica.
 
\end_layout

\begin_layout Standard
El Análisis de carga del sistema incluye medir y monitorear el uso de recursos,
 como CPU, memoria y operaciones de entrada y salida.
 La finalidad de esto es ver cuál es el cuello de botella general del Sistema.
 Si es intensivo en capacidad de cómputo, en memoria o tráfico de red y
 operaciones de lecto-escritura.
 Para este análisis se usaron herramientas como htop, atop e iotop.
 
\end_layout

\begin_layout Standard
Finalmente, Analizar el estado de la cola de procesamiento es el factor
 determinante para entender el resultado de la prueba.
 En términos generales, dada la característica de TiX en donde el tráfico
 es constante, si la cantidad de paquetes que se están encolando para procesamie
nto es mayor que la capacidad de procesarlos, el sistema se va a ir acercando
 lentamente al colapso.
 Esto se puede visualizar analizando el gráfico que provee RabbitMQ sobre
 el estado de la cola.
 
\end_layout

\begin_layout Subsubsection
Resultados
\end_layout

\begin_layout Standard
Luego de correr la prueba de carga múltiples veces, la conclusión es que
 el sistema, en las condiciones actuales, es capaz de soportar 2200 usuarios
 concurrentes.
 
\end_layout

\begin_layout Standard
Durante las distintas pruebas se pudo ver si bien la carga del servidor
 aumenta conforme aumenta la cantidad de clientes, el servidor no está todo
 el tiempo consumiendo al máximo sus recursos.
 Sino que por el contrario, que durante el tiempo de máxima carga hay momentos
 de actividad baja y momentos de saturación.
 
\end_layout

\begin_layout Standard
El momento de mayor consumo de recursos o de saturación es cuando se están
 procesando las métricas, como se puede ver en la figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:max-usage-saturado"

\end_inset

.
 Esto se debe a que además del procesamiento, la API está recibiendo las
 métricas generadas e insertándolas en la base de datos.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename img/report-tests/max-usage-saturado.png
	lyxscale 50
	scale 33
	BoundingBox 0bp 0bp 1750bp 500bp

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Captura de Pantalla mostrando la salida de HTOP al momento en que hay un
 pico de consumo de recursos en el Servidor del Sistema
\begin_inset CommandInset label
LatexCommand label
name "fig:max-usage-saturado"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Luego, el momento de baja actividad corresponde con el régimen regular del
 Sistema de Ingesta, como se muestra en la figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:min-usage-saturado"

\end_inset

.
 Esto es, la toma de paquetes desde el tix-time-server, el procesamiento
 de los datos en el tix-time-condenser y los consultados generadas contra
 la tix-api.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename img/report-tests/min-usage-saturado.png
	lyxscale 33
	scale 33

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Captura de Pantalla mostrando la salida de HTOP al momento en que hay un
 consumo moderado a bajo de recursos en el Servidor del Sistema
\begin_inset CommandInset label
LatexCommand label
name "fig:min-usage-saturado"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Lo lleva a la conclusión que existen tres servicios bien diferenciados con
 distintos niveles de requerimientos.
 Por un lado la tix-api, debido a su conexión con la base de datos.
 Por otro el tix-time-server y el tix-time-condenser, que realizan un trabajo
 más rutinario y monótono con una carga constante del sistema.
 Y finalmente el tix-time-processor, que realiza un trabajo de procesamiento
 por lotes con un consumo fuerte en cortos periodos, y un consumo nulo el
 tiempo restante.
 
\end_layout

\begin_layout Standard
También, a partir de estas imágenes podemos ver que el Sistema es intensivo
 en Procesamiento, pero no en memoria.
 Ocupando en momentos de máxima saturación el 34% de la memoria disponible
 con una configuración de una instancia de cada servicio, como se ve en
 la figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mem-usage-saturado"

\end_inset

.
 Para esta configuración es que el sistema logró procesar 1900 usuarios
 concurrentes.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename img/report-tests/mem-usage-saturado.png
	lyxscale 33
	scale 33

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Captura de Pantalla mostrando la salida de HTOP al momento en que hay un
 pico de consumo de recursos en el Servidor del Sistema con los procesor
 ordenados por consumo de memoria
\begin_inset CommandInset label
LatexCommand label
name "fig:mem-usage-saturado"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
El sistema entero no satura los recursos del servidor, sino que el tiempo
 de respuesta para atender los mensajes que llegan en la cola no es el suficient
e.
 
\end_layout

\begin_layout Standard
La primera cola en saturarse, como se puede ver en las imágenes 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:server-condenser-staging-saturado"

\end_inset

 e 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:celery-queue-saturado"

\end_inset

 es la que conecta el tix-time-server con el tix-time-condenser.
 Agregar más instancias de este último servicio permite mejorar el rendimiento
 general del sistema.
 Pero cada instancia nueva lo mejora marginalmente.
 Las razones de esto no fueron profundizadas, pero las hipótesis que surgieron
 son: 
\end_layout

\begin_layout Itemize
Un problema de configuración del mismo servicio tix-time-condenser, que
 no le permite tomar una mayor cantidad de mensajes de la cola.
 
\end_layout

\begin_layout Itemize
Un problema de configuración de alguno de los otros servicios con los que
 interactúa (RabbitMQ y tix-api), que no le permite escalar linealmente.
 
\end_layout

\begin_layout Itemize
Un problema de infraestructura, consecuencia directa de estar corriendo
 todo en un mismo servidor.
 Es decir, la misma infraestructura es el cuello de botella.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename img/report-tests/server-condenser-stage-saturado.png
	lyxscale 50
	scale 33

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Panel de Control de RabbitMQ mostrando la cola que conecta el tix-time-server
 con el tix-time-condenser saturada
\begin_inset CommandInset label
LatexCommand label
name "fig:server-condenser-staging-saturado"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename img/report-tests/celery-saturado.png
	lyxscale 50
	scale 33

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Panel de Control de RabbitMQ mostrando la cola que usa Celery al momento
 de saturación del sistema
\begin_inset CommandInset label
LatexCommand label
name "fig:celery-queue-saturado"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Para poder hacer esto se debe hacer un perfilado más específico de estos
 servicios con herramientas como NewRelic, Pingdom Server Monitor o DataDog.
 
\end_layout

\begin_layout Standard
Como se menciona, se probaron varias configuraciones con distintos resultados,
 mostradas en la tabla 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:stress-test-configs"

\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="6">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
server
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
condenser
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
processor (
\noun on
beat
\noun default
)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
processor (
\noun on
worker
\noun default
)
\begin_inset Foot
status open

\begin_layout Plain Layout
Entre paréntesis figura el periodo de procesamiento.
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
API
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Usuarios
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1 (1 min)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1800
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2 (1 min)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1800
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1 (5 min)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1800
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1 (5 min)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1900
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1 (5 min)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2200
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Caption Standard

\begin_layout Plain Layout
Configuraciones usadas para la prueba de carga
\begin_inset CommandInset label
LatexCommand label
name "tab:stress-test-configs"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_body
\end_document
